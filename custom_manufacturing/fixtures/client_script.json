[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 0,
  "modified": "2025-11-06 16:40:39.416225",
  "module": "Custom Manufacturing",
  "name": "Work Order Dialog",
  "script": "// Override the make_job_card function\r\nfrappe.ui.form.on('Work Order', {\r\n    onload: function(frm) {\r\n        // Override the make_job_card method after form loads\r\n        frm.events.make_job_card = function(frm) {\r\n            let qty = 0;\r\n            let operations_data = [];\r\n\r\n            const dialog = frappe.prompt(\r\n                {\r\n                    fieldname: \"operations\",\r\n                    fieldtype: \"Table\",\r\n                    label: __(\"Operations\"),\r\n                    fields: [\r\n                        {\r\n                            fieldtype: \"Link\",\r\n                            fieldname: \"operation\",\r\n                            label: __(\"Operation\"),\r\n                            read_only: 1,\r\n                            in_list_view: 1,\r\n                        },\r\n                        {\r\n                            fieldtype: \"Link\",\r\n                            fieldname: \"workstation\",\r\n                            label: __(\"Workstation\"),\r\n                            read_only: 1,\r\n                            in_list_view: 1,\r\n                        },\r\n                        {\r\n                            fieldtype: \"Link\",\r\n                            fieldname: \"shift\",\r\n                            label: __(\"Shift\"),\r\n                            options: \"Shift\",\r\n                            read_only: 0,\r\n                            in_list_view: 1,\r\n                        },\r\n                        {\r\n                            fieldtype: \"Data\",\r\n                            fieldname: \"name\",\r\n                            label: __(\"Operation Id\"),\r\n                        },\r\n                        {\r\n                            fieldtype: \"Float\",\r\n                            fieldname: \"pending_qty\",\r\n                            label: __(\"Pending Qty\"),\r\n                        },\r\n                        {\r\n                            fieldtype: \"Float\",\r\n                            fieldname: \"qty\",\r\n                            label: __(\"Quantity to Manufacture\"),\r\n                            read_only: 0,\r\n                            in_list_view: 1,\r\n                        },\r\n                        {\r\n                            fieldtype: \"Float\",\r\n                            fieldname: \"batch_size\",\r\n                            label: __(\"Batch Size\"),\r\n                            read_only: 1,\r\n                        },\r\n                        {\r\n                            fieldtype: \"Int\",\r\n                            fieldname: \"sequence_id\",\r\n                            label: __(\"Sequence Id\"),\r\n                            read_only: 1,\r\n                        },\r\n                        {\r\n                            fieldtype: \"Link\",\r\n                            fieldname: \"bom\",\r\n                            label: __(\"BOM\"),\r\n                            read_only: 1,\r\n                        },\r\n                    ],\r\n                    data: operations_data,\r\n                    in_place_edit: true,\r\n                    get_data: function () {\r\n                        return operations_data;\r\n                    },\r\n                },\r\n                function () {\r\n                    const selected_rows = dialog.fields_dict[\"operations\"].grid.get_selected_children();\r\n                    if (selected_rows.length == 0) {\r\n                        frappe.msgprint(__(\"Please select atleast one operation to create Job Card\"));\r\n                        return;\r\n                    }\r\n                    frappe.call({\r\n                        method: \"erpnext.manufacturing.doctype.work_order.work_order.make_job_card\",\r\n                        freeze: true,\r\n                        args: {\r\n                            work_order: frm.doc.name,\r\n                            operations: selected_rows,\r\n                        },\r\n                        callback: function () {\r\n                            frm.reload_doc();\r\n                        },\r\n                    });\r\n                },\r\n                __(\"Job Card\"),\r\n                __(\"Create\")\r\n            );\r\n\r\n            dialog.fields_dict[\"operations\"].grid.grid_buttons.hide();\r\n\r\n            var pending_qty = 0;\r\n            frm.doc.operations.forEach((data) => {\r\n                if (data.completed_qty + data.process_loss_qty != frm.doc.qty) {\r\n                    pending_qty = frm.doc.qty - flt(data.completed_qty) - flt(data.process_loss_qty);\r\n\r\n                    if (pending_qty) {\r\n                        dialog.fields_dict.operations.df.data.push({\r\n                            name: data.name,\r\n                            operation: data.operation,\r\n                            workstation: data.workstation,\r\n                            shift: data.shift || \"\",\r\n                            batch_size: data.batch_size,\r\n                            qty: pending_qty,\r\n                            pending_qty: pending_qty,\r\n                            sequence_id: data.sequence_id,\r\n                            bom: data.bom,\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n            dialog.fields_dict.operations.grid.refresh();\r\n        };\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Card",
  "enabled": 1,
  "modified": "2025-12-01 14:48:24.998980",
  "module": "Custom Manufacturing",
  "name": "test1",
  "script": "// -------------------- TIME RECORD FUNCTION --------------------\r\nfunction record_time(frm) {\r\n    let rows = frm.doc.custom_process_log_data || [];\r\n\r\n    // If no rows exist, initialize one\r\n    if (rows.length === 0) {\r\n        rows.push({\r\n            time:\"\", atomizer_hz:\"\", atomizer_amp:\"\", atomizer_rpm:\"\",\r\n            idfan_hz:\"\", idfan_amp:\"\", idfan_rpm:\"\", ca_fan_hz:\"\", oil_add:\"\", oil_remove:\"\",\r\n            rpm:\"\", pressure:\"\", amp:\"\", inlet_temp:\"\", outlet_temp:\"\", cyclone2_inlet:\"\", cyclone2_outlet:\"\",\r\n            hot_air_temp:\"\", hot_air_pressure:\"\", bed_temp:\"\"\r\n        });\r\n    }\r\n\r\n    // Last row\r\n    let last = rows[rows.length - 1];\r\n\r\n    // If last row already has time -> create a new row\r\n    if (last.time) {\r\n        rows.push({\r\n            time:\"\", atomizer_hz:\"\", atomizer_amp:\"\", atomizer_rpm:\"\",\r\n            idfan_hz:\"\", idfan_amp:\"\", idfan_rpm:\"\", ca_fan_hz:\"\", oil_add:\"\", oil_remove:\"\",\r\n            rpm:\"\", pressure:\"\", amp:\"\", inlet_temp:\"\", outlet_temp:\"\", cyclone2_inlet:\"\", cyclone2_outlet:\"\",\r\n            hot_air_temp:\"\", hot_air_pressure:\"\", bed_temp:\"\"\r\n        });\r\n        last = rows[rows.length - 1];\r\n    }\r\n\r\n    // Fill current time HH:mm:ss\r\n    let now = moment().format(\"HH:mm:ss\");\r\n    last.time = now;\r\n\r\n    // Save & re-render\r\n    frm.set_value(\"custom_process_log_data\", rows);\r\n    render_custom_table(frm);\r\n}\r\n\r\n// -------------------- RENDER CUSTOM TABLE --------------------\r\nfunction render_custom_table(frm) {\r\n    let wrapper = frm.fields_dict[\"custom_data_entry_table\"].$wrapper;\r\n    wrapper.empty();\r\n\r\n    let rows = frm.doc.custom_process_log_data || [\r\n        {time:\"\", atomizer_hz:\"\", atomizer_amp:\"\", atomizer_rpm:\"\",\r\n         idfan_hz:\"\", idfan_amp:\"\", idfan_rpm:\"\",\r\n         feed_pressure:\"\", inlet_temp:\"\", outlet_temp:\"\"}\r\n    ];\r\n\r\n    let html = `\r\n        <table class=\"table table-bordered\" style=\"font-size:12px; width:101.5%;\">\r\n            <thead>\r\n                <tr>\r\n                    <th rowspan=\"2\" style=\"vertical-align: middle;\">Time</th>\r\n                    <th colspan=\"2\" class=\"text-center\">Atomizer</th>\r\n                    <th colspan=\"3\" class=\"text-center\">ID Fan</th>\r\n                    <th rowspan=\"2\" class=\"text-center\">CA Fan Hz</th> \r\n                    <th colspan=\"2\" class=\"text-center\">Oil</th>\r\n                    <th colspan=\"3\" class=\"text-center\">Feed Pump</th>\r\n                    <th rowspan=\"2\" class=\"text-center\">Inlet Temp</th>\r\n                    <th rowspan=\"2\" class=\"text-center\">Outlet Temp</th>\r\n                    <th colspan=\"2\" class=\"text-center\">Cyclone-2</th>\r\n                    <th colspan=\"2\" class=\"text-center\">Hot Air</th>\r\n                    <th rowspan=\"2\" class=\"text-center\">Bed Temp</th>\r\n                </tr>\r\n                <tr>\r\n                    <th>Hz</th><th>Amp</th>\r\n                    <th>Hz</th><th>Amp</th><th>RPM</th><th>Add</th><th>Remove</th>\r\n                    <th>RPM</th><th>Pressure</th><th>Amp</th>\r\n                    <th>Inlet</th><th>Outlet</th><th>Temp</th><th>Pressure</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n    `;\r\n\r\n    rows.forEach((row, i) => {\r\n        html += `\r\n            <tr>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"time\" value=\"${row.time || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"atomizer_hz\" value=\"${row.atomizer_hz || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"atomizer_amp\" value=\"${row.atomizer_amp || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"idfan_hz\" value=\"${row.idfan_hz || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"idfan_amp\" value=\"${row.idfan_amp || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"idfan_rpm\" value=\"${row.idfan_rpm || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"ca_fan_hz\" value=\"${row.ca_fan_hz || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"oil_add\" value=\"${row.oil_add || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"oil_remove\" value=\"${row.oil_remove || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"rpm\" value=\"${row.rpm || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"pressure\" value=\"${row.pressure || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"amp\" value=\"${row.amp || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"inlet_temp\" value=\"${row.inlet_temp || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"outlet_temp\" value=\"${row.outlet_temp || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"cyclone2_inlet\" value=\"${row.cyclone2_inlet || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"cyclone2_outlet\" value=\"${row.cyclone2_outlet || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"hot_air_temp\" value=\"${row.hot_air_temp || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"hot_air_pressure\" value=\"${row.hot_air_pressure || \"\"}\"></td>\r\n                <td><input class=\"form-control\" data-row=\"${i}\" data-field=\"bed_temp\" value=\"${row.bed_temp || \"\"}\"></td>\r\n            </tr>\r\n        `;\r\n    });\r\n\r\n    html += `\r\n        </tbody>\r\n        </table>\r\n        <button class=\"btn btn-sm btn-primary\" id=\"add-row-btn\">Add Row</button>\r\n    `;\r\n\r\n    wrapper.html(html);\r\n\r\n    // Save on input change\r\n    wrapper.find(\"input\").on(\"change\", function() {\r\n        let row = $(this).data(\"row\");\r\n        let field = $(this).data(\"field\");\r\n        rows[row][field] = $(this).val();\r\n        frm.set_value(\"custom_process_log_data\", rows);\r\n    });\r\n\r\n    // Add row button\r\n    wrapper.find(\"#add-row-btn\").on(\"click\", () => {\r\n        rows.push({\r\n            time:\"\", atomizer_hz:\"\", atomizer_amp:\"\", atomizer_rpm:\"\",\r\n            idfan_hz:\"\", idfan_amp:\"\", idfan_rpm:\"\", ca_fan_hz:\"\", oil_add:\"\", oil_remove:\"\",\r\n            rpm:\"\", pressure:\"\", amp:\"\", inlet_temp:\"\", outlet_temp:\"\", cyclone2_inlet:\"\", cyclone2_outlet:\"\",\r\n            hot_air_temp:\"\", hot_air_pressure:\"\", bed_temp:\"\"\r\n        });\r\n\r\n        frm.set_value(\"custom_process_log_data\", rows);\r\n        render_custom_table(frm);\r\n    });\r\n}\r\n\r\n// -------------------- Frappe FORM SCRIPT --------------------\r\nfrappe.ui.form.on(\"Job Card\", {\r\n    refresh(frm) {\r\n        render_custom_table(frm);\r\n\r\n        // Style the button if function exists\r\n        if (typeof style_glr_record_button === \"function\") {\r\n            style_glr_record_button(frm, \"custom_record_\");\r\n        }\r\n\r\n        // Attach click to record_time\r\n        if (frm.fields_dict.custom_record_) {\r\n            frm.fields_dict.custom_record_.$wrapper.find(\"button\").off(\"click\").on(\"click\", function() {\r\n                record_time(frm);\r\n            });\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 }
]